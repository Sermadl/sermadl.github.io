---
title: "MSA êµ¬í˜„í•˜ê¸°(6) - ì¿ ë²„ë„¤í‹°ìŠ¤ì— ë°°í¬í•˜ê¸° (CI/CD êµ¬ì¶•ê¹Œì§€) (feat. k8s, Jenkins, ArgoCD)"
categories: [Spring Boot, MSA, k8s]
tags:
  [
    MSA,
    k8s,
    Jenkins,
    ArgoCD,
    CI/CD,
    CI,
    CD,
    Spring Boot,
    Java,
    SKALA,
    SKALA1ê¸°,
    SK
  ]
---

> Skala ê³¼ì •ì—ì„œ ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ êµ¬ì¡°ì— ëŒ€í•´ ìƒˆë¡­ê²Œ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
> ë°°ìš´ ê²ƒì„ ì‹¤ì œë¡œ êµ¬í˜„í•´ë³´ê¸° ìœ„í•´ ì´ ì—¬ì •ì„ ì‹œì‘í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.<br>[ì²˜ìŒ ê¸€ë¶€í„° ë³´ëŸ¬ê°€ê¸°](<https://sermadl.github.io/posts/MSA(1)/>)<br>

ì´ ê¸€ì—ì„œëŠ” ë‹¨ìˆœí•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµì„ ë„˜ì–´, MSA ì•„í‚¤í…ì²˜ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ì— ì ìš©í•˜ê³ , CI/CDë¥¼ êµ¬ì¶•í•˜ê¸°ê¹Œì§€ì˜ ì—¬ì •ì„ ê¸°ë¡í•˜ì˜€ë‹ˆë‹¤.

<hr>

## í”„ë¡œì íŠ¸ ê°œìš”

- **ëª©í‘œ**: Kubernetes í™˜ê²½ì—ì„œ MSA ì„œë¹„ìŠ¤ë¥¼ ë„ì›Œë³´ê³ , ë°°í¬ ìë™í™”ê¹Œì§€ êµ¬ì¶•í•˜ê¸°
- **ì‚¬ìš© ê¸°ìˆ  ìŠ¤íƒ**
  - Backend: Java Spring Boot
  - Frontend: Vue.js
  - Infrastructure: Kubernetes, Docker, Jenkins, ArgoCD
  - Database: MariaDB
  - Message Broker: Kafka

ê¸°ì¡´ì— ê°œë°œí•˜ê³  ìˆë˜ MSA í”„ë¡œì íŠ¸ë¥¼ k8sì— ì˜¬ë ¤, ì§€ì†ì ì¸ í†µí•© ë° ë°°í¬ ìë™í™”ë¥¼ í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.<br>
(í˜ë“¤ì–´ìš”)<br>

ê¸°ì¡´ ê°œë°œì—¬ì •ì´ ê¶ê¸ˆí•˜ì‹  ë¶„ë“¤ì€ [ì—¬ê¸°](<https://sermadl.github.io/posts/MSA(1)/>)ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.<br>

<hr>

## MSA ì•„í‚¤í…ì²˜ ì„¤ê³„

- ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤
  - [ ] API Gateway(Aggregation ì„œë¹„ìŠ¤)
  - [ ] ì‚¬ìš©ì ì„œë¹„ìŠ¤
  - [ ] ì£¼ë¬¸ ì„œë¹„ìŠ¤
  - [ ] ìƒí’ˆ ì„œë¹„ìŠ¤
- ì„œë¹„ìŠ¤ ê°„ í†µì‹ : REST API / Kafka ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ 
- ì‚¬ìš©ì, ì£¼ë¬¸, ìƒí’ˆ ì„œë¹„ìŠ¤ì— ëŒ€í•œ DBë„ ëª¨ë‘ ë¶„ë¦¬

> ğŸ’¡ ê¸°ì¡´ì— ì„¤ê³„í•´ ë‘” ì•„í‚¤í…ì²˜ì—ì„œ `Eureka Server` ë§Œ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!<br><br>![architecture](/assets/img/system-architecture-rest-api-gateway.png)

<hr>

### Eureka Serverë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ì´ìœ ?

ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œëŠ” `Service` ë¥¼ í†µí•´ ê° podê°€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê°–ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë‹¨, í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)<br>

ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì´ìš©í•˜ë©´, Eureka Serverê°€ ì„œë²„ë¥¼ ì°¾ì•„ì£¼ì§€ ì•Šì•„ë„, ì—”ë“œí¬ì¸íŠ¸ë§Œ ì•Œê³  ìˆë‹¤ë©´ ê° ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆê³  Eureka ë³´ë‹¤ ë” ë¹ ë¥´ê²Œ ì„œë²„ê°€ ë“±ë¡ë˜ê¸° ë•Œë¬¸ì— ì´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>

## ê¸°ë³¸ ëª…ë ¹ì–´ ì •ë¦¬

### pod ë°°í¬ ì‹œ

- kubectl apply -f deploy.yaml

### service ë“±ë¡ ì‹œ

- kubectl apply -f service.yaml

ê·¸ì™¸ ë‹¤ë¥¸ yaml íŒŒì¼ì„ ì ìš©í•  ë•Œì—ëŠ” ëª¨ë‘ `kubectl apply -f {íŒŒì¼ëª…}` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤!<br>

### ìƒì„±ëœ ê²ƒ(?)ë“¤ í™•ì¸í•˜ê¸°

- kubectl get pod

> pod ì´ì™¸ì— service, deploy, configmaps, ingress ë“±ì„ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìœ„ ëª…ë ¹ì–´ë“¤ì„ ì‹¤í–‰í•˜ë©´ ìƒì„±ëœ ëª¨ë“  ìƒì„±ë¬¼(?)ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>

## Kubernetesì— pod ë„ìš°ê¸°

ì¿ ë²„ë„¤í‹°ìŠ¤ì— podë¥¼ ë„ìš°ê¸° ìœ„í•´ì„œëŠ”<br>

1. ì†ŒìŠ¤ì½”ë“œë¥¼ ë„ì»¤ ì´ë¯¸ì§€ë¡œ ë§Œë“ ë‹¤
2. ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•œë‹¤.(ì›ê²© ë„ì»¤ ì´ë¯¸ì§€ ì €ì¥ì†Œì— ì—…ë¡œë“œí•©ë‹ˆë‹¤)
3. ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë²„ì—ì„œ `deploy.yaml` ì´ ì‹¤í–‰ë˜ë©° ì›ê²© ì €ì¥ì†Œì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë°›ì•„ì™€ pod ë‚´ë¶€ì— ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ì—¬ podë¥¼ ë„ìš´ë‹¤.

ìœ„ ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>

<hr>

### Dockerfile ìƒì„±í•˜ê¸°

ì €ëŠ” Spring boot, Vue.jsë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ ë‘˜ì˜ Dockerfileì„ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ë‘ì—ˆìŠµë‹ˆë‹¤.<br>

**[ spring bootì˜ Dockerfile ]**

```Dockerfile
# ë² ì´ìŠ¤ ì´ë¯¸ì§€ë¡œ OpenJDK 17 ë²„ì „ì˜ JRE ì´ë¯¸ì§€ ì‚¬ìš©
FROM openjdk:17-jdk-slim
WORKDIR /app

# ì™¸ë¶€ì—ì„œ ì»¨í…Œì´ë„ˆì˜ 19901 í¬íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
EXPOSE 19901

# ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ jar íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
COPY ./gatewayserver/target/api-gateway-0.0.1-SNAPSHOT.jar app.jar

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","app.jar"]
```

<hr>

**[ vue.jsì˜ Dockerfile ]**

```Dockerfile
# Build stage
FROM node:20.14.0 AS build-stage
WORKDIR /app
COPY package*.json ./
RUN npm pkg set type=module
RUN npm install
COPY . .
RUN npm run build

# Production stage
FROM nginx:stable-alpine

# Add our custom nginx config
COPY default.conf /etc/nginx/conf.d/

COPY --from=build-stage /app/dist /etc/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

**[ Vue.jsë¥¼ ìœ„í•œ nginx html ì„¤ì •ìš© default.conf ]**

```conf
server {
    listen 80;

    location /api/ {
        proxy_pass http://sk067-my-apigateway:19901/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location / {
        alias /etc/nginx/html/;
        try_files $uri $uri/ /index.html;

        if ($request_method !~ ^(GET|POST|PUT|DELETE|OPTIONS)$) {
            return 405;
        }
    }
}
```

> ğŸ’¡ ë§Œì•½ ARM64(M1, M2, ... ë§¥ë¶) ê¸°ë°˜ ë…¸íŠ¸ë¶ ì‚¬ìš©ìë¼ë©´,<br>docker build ì‹œ `buildx` ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¹Œë“œí•´ì£¼ì„¸ìš”..!!<br>

```shell
sudo docker buildx build \
  --platform linux/amd64 \
  -t {ì›ê²© ì €ì¥ì†Œ url}/{ì´ë¯¸ì§€ ì´ë¦„}:{ì´ë¯¸ì§€ ë²„ì „} \
  --push .
```

ì €ëŠ” ìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¹Œë“œí–ˆìŠµë‹ˆë‹¤!

<hr>

### configmap.yaml íŒŒì¼ ìƒì„±í•˜ê¸°

ì €ëŠ” ìš°ì„  application.ymlì„ í†µí•´ ì§ì ‘ ë¹Œë“œí•˜ë„ë¡ í–ˆì—ˆëŠ”ë°,<br>

configmapì„ ì ìš©í•˜ì§€ ì•Šìœ¼ë©´ application-prod, application-dev ì´ë ‡ê²Œ ë‘ ê°€ì§€ì˜ í”„ë¡œí•„ì„ í†µí•´ ê°œë°œìš© ë³€ìˆ˜ì™€ ë°°í¬ìš© ë³€ìˆ˜ë¥¼ ê´€ë¦¬í•´ì•¼ë§Œ í–ˆìŠµë‹ˆë‹¤.<br>

ë§¤ë²ˆ ì½”ë“œì— ì§ì ‘ ë“¤ì–´ê°€ì„œ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ê·€ì°®ì•˜ê¸° ë•Œë¬¸ì— `configmap.yaml` ì„ ì ìš©í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ í›¨ì”¬ ìœ ë™ì ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.<br>

ì €ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ê°œë°œìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì•„ì„œ í•˜ë‚˜ì˜ configmapë§Œ ìƒì„±í–ˆì§€ë§Œ<br>
configmapë„ ê°œë°œìš©ê³¼ ë°°í¬ìš©ìœ¼ë¡œ ë¹Œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>

**[ configmap.yaml ]**

```yaml
# gateway-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: gateway-config
data:
  USER_URI: http://sk067-my-userserver:8081
  ORDER_URI: http://sk067-my-orderserver:8082
  ITEM_URI: http://sk067-my-itemserver:8083
```

ê° ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ì˜ urië¥¼ ì„¤ì •í•˜ëŠ” ë³€ìˆ˜ë¥¼ configmapì„ í†µí•´ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.<br>

<hr>

## Ingress.yaml íŒŒì¼ ìƒì„±í•˜ê¸°

### Ingress?

Serviceì™€ ë‹¬ë¦¬ IngressëŠ” ì™¸ë¶€ì— ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„¤ì •í•´ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.<br>

`tls` ì„¤ì •ì„ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ë”°ë¡œ ë³µì¡í•œ ì„¤ì • ê³¼ì • ì—†ì´, ë³´ìœ í•œ ë„ë©”ì¸ì˜ í•˜ìœ„ ë„ë©”ì¸ì„ ìë™ìœ¼ë¡œ CA ì¸ì¦ë°›ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>

**[ ingress.yaml ]**

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  name: ${USER_NAME}-mypang-ingress
  namespace: ${NAMESPACE}
spec:
  ingressClassName: public-nginx
  rules:
    - host: ${USER_NAME}-mypang.skala25a.project.skala-ai.com
      http:
        paths:
          - backend:
              service:
                name: ${USER_NAME}-${SERVICE_NAME}
                port:
                  number: 19901
            path: /
            pathType: Prefix
  tls:
    - hosts:
        - ${USER_NAME}-mypang.skala25a.project.skala-ai.com
      secretName: ${USER_NAME}-mypang-tls-secret
```

ì´ë ‡ê°œ í•˜ê³  ingress.yamlì„ ì ìš©ì‹œì¼œì£¼ë©´ ë“±ë¡í•´ ë‘” urlë¡œ ì ‘ì†ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!<br>

[ë§ˆì´íŒ¡ êµ¬ê²½í•˜ëŸ¬ ê°€ê¸°](https://mypang.skala25a.project.skala-ai.com/)

<hr>

## Liveness & Readiness Probe ì ìš©

### Actuator ì ìš©í•˜ê¸°

Livenessì™€ ReadinessëŠ” ì„œë²„ì˜ ì‹¤ì œ API ê²½ë¡œë¡œ ì¼ì • ê°„ê²©ì„ ë‘ê³  ê³„ì†í•´ì„œ ìš”ì²­ì„ ë³´ë‚¸ í›„,<br>
ì„ê³„ê°’ ì´ìƒì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ë„ì™€ì£¼ë„ë¡ ë§Œë“œëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.<br>

ActuatorëŠ” Swaggerì™€ ë¹„ìŠ·í•˜ê²Œ ë³µì¡í•œ ì„¤ì • ì—†ì´ë„, ìë™ìœ¼ë¡œ ì„œë²„ì˜ ìƒíƒœë¥¼ ì•Œë ¤ì£¼ëŠ” ê¸°ëŠ¥ì´ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.<br>

ì‹¤ì œ actuatorë¥¼ ì ìš©í•˜ê²Œ ë˜ë©´, ì„œë²„ì˜ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ì‰½ê²Œ ì»¨íŠ¸ë¡¤í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—<br>
ì œê°€ ì§ì ‘ ë§Œë“  APIë¥¼ ì‚¬ìš©í•´ì„œ actuatorë¥¼ í‰ë‚´ë‚´ë³´ì•˜ìŠµë‹ˆë‹¤.<br>

**[ CustomActuatorController.java ]**

```java
@RestController
@RequestMapping("/actuator")
public class CustomActuatorController {

    private final AtomicBoolean isReady = new AtomicBoolean(true);
    private final AtomicBoolean isLive = new AtomicBoolean(true);

    @GetMapping("/health")
    public Mono<ResponseEntity<Map<String, Object>>> health() {
        Map<String, Object> health = new HashMap<>();
        if (isLive.get()) {
            health.put("status", "UP");
            return Mono.just(ResponseEntity.ok(health));
        } else {
            health.put("status", "DOWN");
            return Mono.just(ResponseEntity.status(HttpStatus.BAD_REQUEST).body(health)); // 400
        }
    }

    @GetMapping("/ready")
    public Mono<ResponseEntity<Map<String, Object>>> readiness() {
        Map<String, Object> status = new HashMap<>();
        if (isReady.get()) {
            status.put("status", "READY");
            return Mono.just(ResponseEntity.ok(status));
        } else {
            status.put("status", "NOT READY");
            return Mono.just(ResponseEntity.status(HttpStatus.SERVICE_UNAVAILABLE).body(status)); // 503
        }
    }

    @PostMapping("/health/{flag}")
    public Mono<ResponseEntity<Map<String, Object>>> setReadiness(@PathVariable boolean flag) {
        isLive.set(flag);
        return health();
    }

    @PostMapping("/ready/{flag}")
    public Mono<ResponseEntity<Map<String, Object>>> setLiveness(@PathVariable boolean flag) {
        isReady.set(flag);
        return readiness();
    }
}
```

ì´ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì‘ì„±í•œ í›„, API í…ŒìŠ¤íŠ¸ ê¼­ í•´ë³´ì„¸ìš©,.,.,.!

<hr>

### Liveness Probe

- ì •ì˜: ì»¨í…Œì´ë„ˆê°€ **ì •ìƒ ë™ì‘ ì¤‘ì¸ì§€**ë¥¼ íŒë‹¨
- ì ìš© ë°©ë²• ì˜ˆì‹œ:
  ```yaml
  # deploy.yaml íŒŒì¼ ì¤‘ ì¼ë¶€
  livenessProbe:
    httpGet:
      path: /actuator/health
      port: 8080
    initialDelaySeconds: 5 # startupProbe ì²˜ë¦¬ í›„ 5ì´ˆ ë’¤ íƒì¹¨ ì‹¤í–‰
    periodSeconds: 3 # 3ì´ˆ ì£¼ê¸°ë¡œ íƒì¹¨ ì‹¤í–‰
    failureThreshold: 2 # 2ë²ˆ ì´ìƒ ì‹¤íŒ¨ ì‹œ pod ì¢…ë£Œ, pod Replace í˜¹ì€ pod Restart ì‹¤í–‰
  ```

<hr>

### Readiness Probe

- ì •ì˜: íŠ¸ë˜í”½ì„ ë°›ì„ **ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€** íŒë‹¨
- ì ìš© ë°©ë²• ì˜ˆì‹œ:
  ```yaml
  # deploy.yaml íŒŒì¼ ì¤‘ ì¼ë¶€
  readinessProbe:
    httpGet:
      path: /actuator/ready
      port: 8080
    initialDelaySeconds: 5 # startupProbe ì²˜ë¦¬ í›„ 5ì´ˆ ë’¤ íƒì¹¨ ì‹¤í–‰
    periodSeconds: 3 # 3ì´ˆ ì£¼ê¸°ë¡œ íƒì¹¨ ì‹¤í–‰
    failureThreshold: 2 # 2ë²ˆ ì´ë‚´ ì •ìƒì¼ ê²½ìš° ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë“±ë¡í•¨, ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° ì—”ë“œí¬ì¸íŠ¸ ì œê±°
  ```

> ğŸ” í˜¹ì‹œ Probe ì ìš©ì„ í–ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ì €ì˜ ê²½ìš°ì—ëŠ” ì´ë ‡ê²Œ í•´ê²°í–ˆìŠµë‹ˆë‹¤!

1. ì˜¬ë°”ë¥¸ pathê°€ ì‘ì„±ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê¸°
2. `deploy.yaml` ë‚´ë¶€, Probeë¥¼ ì„¤ì •í•˜ê¸° ì „ì—
   ```yaml
   ports:
     - containerPort: (í¬íŠ¸)
   ```
   ì‘ì„±í•˜ê¸°

<hr>

### ì ìš© í™”ë©´

![actuator-health-check](/assets/img/actuator-health-check.png)
![actuator-ready-check](/assets/img/actuator-ready-check.png)

healthì™€ ready ëª¨ë‘ ì •ìƒì ìœ¼ë¡œ ë–  ìˆìŠµë‹ˆë‹¤.<br>

![postman-health-down](/assets/img/postman-health-0.png)

ì—¬ê¸°ì„œ healthë¥¼ `DOWN` ìƒíƒœë¡œ ë°”ê¿”ë³´ë©´<br>

![health-result](/assets/img/health-down.png)

podì— ë¬¸ì œê°€ ìƒê²¨ ì¬ì‹œì‘í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>

![postman-ready-down](/assets/img/postman-ready-0.png)<br>

ì´ì œ readyë¥¼ `NOT READY` ìƒíƒœë¡œ ë°”ê¿”ë³´ë©´<br>

![ready-result](/assets/img/ready-down.png)

ì¬ì‹œì‘ ì—¬ë¶€ê°€ ë³´ì´ì§€ëŠ” ì•Šì§€ë§Œ, ì¬ì‹œì‘ì„ í•˜ì§€ ì•Šê³  READY ìƒíƒœë§Œ 0/1 ë¡œ ë°”ë€ ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>

<hr>

### Startup Probeë¥¼ ì ìš©í•˜ì§€ ì•Šì€ ì´ìœ ?

Startup ProbeëŠ” podë‚´ ì»¨í…Œì´ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ë„ì›Œì§€ê¸° ì „(Success ì „)ê¹Œì§€ ë‹¤ë¥¸ Probeë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šë„ë¡ ì§€ì›í•´ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.<br>

í•˜ì§€ë§Œ,,<br>

### _**ì„œë²„ì˜ ë¶€íŒ…ì´ ëŠë¦´ ì¼ì´ ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.**_

Spring bootëŠ” 5 ~ 10ì´ˆ ì•ˆì— ë¶€íŒ…ì´ ê°€ëŠ¥í•˜ê³ , ë³µì¡í•œ ì´ˆê¸°í™” ê³¼ì •ì´ ì—†ì—ˆê¸° ë•Œë¬¸ì— `initialDelaySeconds` ë¥¼ í†µí•´ ì„œë²„ ì‹¤í–‰ ì „ ì¶©ë¶„í•œ í…€ì„ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>

ë”°ë¼ì„œ, Startup Probeë¥¼ ì ìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!

<hr>

## ìµœì¢… deploy.yaml ë° service.yaml ì‘ì„±í•˜ê¸°

**[ deploy.yaml ]**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ${USER_NAME}-${SERVICE_NAME}
  namespace: ${NAMESPACE}
spec:
  replicas: 2
  selector:
    matchLabels:
      app: ${USER_NAME}-${SERVICE_NAME}
  template:
    metadata:
      labels:
        app: ${USER_NAME}-${SERVICE_NAME}
    spec:
      serviceAccountName: default
      containers:
        - name: ${IMAGE_NAME}
          image: ${DOCKER_REGISTRY}/${USER_NAME}-${IMAGE_NAME}:${VERSION}
          imagePullPolicy: Always
          resources:
            requests:
              cpu: "100m"
            limits:
              cpu: "500m"
          env:
            - name: USER_NAME
              value: ${USER_NAME}
            - name: NAMESPACE
              value: ${NAMESPACE}
            - name: USER_URI
              valueFrom:
                configMapKeyRef:
                  name: gateway-config
                  key: USER_URI
            - name: ORDER_URI
              valueFrom:
                configMapKeyRef:
                  name: gateway-config
                  key: ORDER_URI
            - name: ITEM_URI
              valueFrom:
                configMapKeyRef:
                  name: gateway-config
                  key: ITEM_URI
          ports:
            - containerPort: 19901
          livenessProbe:
            httpGet:
              path: /actuator/health
              port: 19901
            initialDelaySeconds: 5
            periodSeconds: 3
            failureThreshold: 2
          readinessProbe:
            httpGet:
              path: /actuator/ready
              port: 19901
            initialDelaySeconds: 5
            periodSeconds: 3
            failureThreshold: 2
```

ì €ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•´ì„œ `${ë³€ìˆ˜}` ë¥¼ ì¹˜í™˜í•  ìˆ˜ ìˆë„ë¡ yaml íŒŒì¼ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.<br>
ê·¸ë˜ì„œ ë”°ë¡œ env.propertiesë¥¼ ë§Œë“¤ì—ˆëŠ”ë°, ì§ì ‘ yamlì„ ì‘ì„±í•´ë„ ì „í˜€ ìƒê´€ì—†ìŠµë‹ˆë‹¤!<br>

<hr>

**[ service.yaml ]**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: ${USER_NAME}-${SERVICE_NAME}
  namespace: ${NAMESPACE}
spec:
  selector:
    app: ${USER_NAME}-${SERVICE_NAME}
  ports:
    - name: http
      protocol: TCP
      port: ${CONTAINER_PORT}
      targetPort: ${CONTAINER_PORT}
  type: ClusterIP
```

ì´ë ‡ê²Œ deployì™€ serviceë¥¼ ì‘ì„±í•œ í›„ì— ê° yamlì„ ì ìš©ì‹œí‚¤ë©´<br>

podê°€ ë„ì›Œì§€ê³ , ì—”ë“œí¬ì¸íŠ¸ê°€ ë“±ë¡ë©ë‹ˆë‹¤!<br>

ì €ëŠ” ì´ 7ê°œì˜ podë¥¼ ë„ì› ìŠµë‹ˆë‹¤.(API Gateway, User/Orde/Item Server, DB, Kafka, Front-UI)<br>

![getPod](/assets/img/k8s-pod.png)

> ëª¨ë“  ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ì— swagger ë° actuator, probe, configmap, ingressë¥¼ ì ìš©í•œ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤,,<br>ëª¨ë‘ API Gateway ì„œë²„ì—ë§Œ ì ìš©í–ˆìŠµë‹ˆë‹¤!(ingressëŠ” front ì„œë²„ì—ë„ ì ìš©í•´ë‘ì—ˆìŠµë‹ˆë‹¤)<br>CI/CDëŠ” ëª¨ë“  ì„œë²„(Spring bootì™€ Vue.js ì„œë²„)ì— ì ìš©í–ˆìŠµë‹ˆë‹¤.

<hr>

## Swaggerë¥¼ í†µí•œ API ë¬¸ì„œí™”

### Springdoc / Swagger UI ì„¤ì • ë°©ë²•

> ì €ì˜ ê²½ìš°ì—ëŠ” ì¼ë°˜ì ì¸ Spring ê°œë°œìë“¤ì´ ì‚¬ìš©í•˜ëŠ” mvcê°€ ì•„ë‹Œ, webflux êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆê¸° ë•Œë¬¸ì— ìŠ¤ì›¨ê±°ë¥¼ ì ìš©í•  ë•Œ ë ˆí¼ëŸ°ìŠ¤ê°€ ì¡°ê¸ˆ ë¶€ì¡±í•´ì„œ ë§ì´ í—¤ë§¸ìŠµë‹ˆë‹¤,,

**[ pom.xml ]**

```xml
<dependency>
    <groupId>org.springdoc</groupId>
    <artifactId>springdoc-openapi-starter-webflux-ui</artifactId>
    <version>2.8.5</version>
</dependency>
```

**[ SwaggerConfig.java ]**

```java
@Configuration
public class SwaggerConfig {
    @Bean
    public OpenAPI openAPI() {
        SecurityScheme securityScheme = new SecurityScheme()
                .type(SecurityScheme.Type.HTTP)
                .scheme("bearer")
                .bearerFormat("JWT")
                .in(SecurityScheme.In.HEADER)
                .name("Authorization");

        SecurityRequirement securityRequirement = new SecurityRequirement()
                .addList("BearerAuth");

        return new OpenAPI()
                .components(new Components()
                        .addSecuritySchemes("JWT Token", securityScheme))
                .addSecurityItem(securityRequirement)
                .info(new Info()
                        .title("Api Gateway API")
                        .description("API ë¬¸ì„œ")
                        .version("1.0.0"))
                .addServersItem(new Server().url("/"));
    }
}
```

ì´ë ‡ê²Œ ë‘ ê°œì˜ íŒŒì¼ë§Œ ì„¤ì •í•˜ê³  ë‚˜ë©´

![swagger-ui](/assets/img/k8s-swagger-ui.png)

ì§œì”. ì´ë ‡ê²Œ Swagger uië¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!<br>

---

## CI/CD: Jenkins + ArgoCD êµ¬ì¶•

### Jenkins

Jenkinsë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´ì„œëŠ” ê½¤ë‚˜ ë³µì¡í•œ ì ˆì°¨ê°€ í•„ìš”í•œëŒ€ìš©,,<br>

ìš°ì„  ì €ëŠ” êµìˆ˜ë‹˜ê¼ì„œ ì£¼ì‹  ë„ì»¤íŒŒì¼ì„ ì´ìš©í•´ì„œ ë¡œì»¬ì— Jenkinsë¥¼ ë„ì› ìŠµë‹ˆë‹¤.<br>

ë„ì»¤ ì‹¤í–‰ ì‹œì— admin ê³„ì •ì´ ë§Œë“¤ì–´ì ¸ì„œ ê·¸ ê³„ì •ì„ ì´ìš©í•´ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤<br>

ì‚¬ì „ì— ì„¤ì¹˜ëœ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œëŠ” (workflow-aggregator, git, git-client, github-branch-source, docker-workflow, pipeline-stage-view, blueocean, credentials-binding, timestamper, job-dsl, configuration-as-code, kubernetes, maven-plugin, junit, htmlpublisher) ê°€ ìˆìŠµë‹ˆë‹¤.<br>

ìœ„ í”ŒëŸ¬ê·¸ì¸ì„ ê¼­! ëª¨ë‘ ì„¤ì¹˜í•´ì•¼ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ìƒí™©ì— ë§ì¶° í•„ìš”í•œ í”ŒëŸ¬ê·¸ì¸ë“¤ë§Œ ì„¤ì¹˜í•´ë„ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.<br>

ì €ëŠ” Vue.jsì˜ ë°°í¬ë„ íŒŒì´í”„ë¼ì¸ì— ì¶”ê°€í–ˆê¸° ë•Œë¬¸ì— ì¶”ê°€ì ìœ¼ë¡œ Node.js í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í–ˆìŠµë‹ˆë‹¤.<br>
ì„¤ì¹˜ ì´í›„ Jenkins ê´€ë¦¬ > Tools > NodeJS installationsì— êµ¬ì„±ì„ ì¶”ê°€ í•´ì•¼ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.<br>

**_Credentialsë„ ë¯¸ë¦¬ ë“±ë¡í•˜ì—¬ Gitì— ì—°ê²°í•´ë‘ì–´ì•¼ í•©ë‹ˆë‹¤!_**

- íŒŒì´í”„ë¼ì¸ ì‘ì„± ë°©ì‹ (`Jenkinsfile` ì˜ˆì‹œ):

  ```groovy
    pipeline {
        agent any

        environment {
            GIT_URL = 'https://github.com/Sermadl/devops-source.git'
            GIT_USER_NAME = 'Sermadl'
            GIT_USER_EMAIL = 'rlatpdms1014@gmail.com'
            GIT_BRANCH = 'main' // ë˜ëŠ” master
            GIT_ID = 'skala-github-id' // Jenkinsì— ë“±ë¡í•œ GitHub credential ID
            IMAGE_REGISTRY = 'amdp-registry.skala-ai.com/skala25a'
            IMAGE_NAME = 'sk067-my-apigateway'
            IMAGE_TAG = '2.0.0'
            DOCKER_CREDENTIAL_ID = 'skala-image-registry-id'  // Harbor ì¸ì¦ ì •ë³´ ID
        }

        stages {
            stage('Clone Repository') {
                steps {
                    git branch: "${GIT_BRANCH}",
                        url: "${GIT_URL}",
                        credentialsId: "${GIT_ID}"   // GitHub PAT credential ID
                }
            }

            stage('Build with Maven') {
                steps{
                    dir('api-gateway/gatewayserver') {
                        sh 'chmod +x mvnw'
                        sh './mvnw clean package -DskipTests'
                    }
                }
            }

            stage('Docker Build & Push') {
                steps {
                    dir('api-gateway'){
                        script {
                            // í•´ì‹œì½”ë“œ 12ìë¦¬ ìƒì„±
                            def hashcode = sh(
                                script: "date +%s%N | sha256sum | cut -c1-12",
                                returnStdout: true
                            ).trim()

                            // Build Number + Hash Code ì¡°í•© (IMAGE_TAGëŠ” ìœ ì§€)
                            def FINAL_IMAGE_TAG = "${IMAGE_TAG}-${BUILD_NUMBER}-${hashcode}"
                            echo "Final Image Tag: ${FINAL_IMAGE_TAG}"

                            docker.withRegistry("https://${IMAGE_REGISTRY}", "${DOCKER_CREDENTIAL_ID}") {
                                def appImage = docker.build("${IMAGE_REGISTRY}/${IMAGE_NAME}:${FINAL_IMAGE_TAG}", "--platform linux/amd64 .")
                                appImage.push()
                            }

                            // ìµœì¢… ì´ë¯¸ì§€ íƒœê·¸ë¥¼ envì— ë“±ë¡ (ë‚˜ì¤‘ì— deploy.yaml ìˆ˜ì •ì— ì‚¬ìš©)
                            env.FINAL_IMAGE_TAG = FINAL_IMAGE_TAG
                        }
                    }
                }
            }



            stage('Update deploy.yaml and Git Push') {
                steps {
                    dir('api-gateway') {
                        script {
                            def newImageLine = "        image: ${env.IMAGE_REGISTRY}/${env.IMAGE_NAME}:${env.FINAL_IMAGE_TAG}"
                            def gitRepoPath = env.GIT_URL.replaceFirst(/^https?:\/\//, '')

                            sh """
                                sed -i 's|^[[:space:]]*image:.*\$|${newImageLine}|g' ./argocd-k8s/deploy.yaml
                                cat ./argocd-k8s/deploy.yaml
                            """

                            sh """
                                git config user.name "$GIT_USER_NAME"
                                git config user.email "$GIT_USER_EMAIL"
                                git add ./argocd-k8s/deploy.yaml || true
                            """

                            withCredentials([usernamePassword(credentialsId: "${env.GIT_ID}", usernameVariable: 'GIT_PUSH_USER', passwordVariable: 'GIT_PUSH_PASSWORD')]) {
                                sh """
                                    if ! git diff --cached --quiet; then
                                        git commit -m "[AUTO] Update deploy.yaml with image ${env.FINAL_IMAGE_TAG}"
                                        git remote set-url origin https://${GIT_PUSH_USER}:${GIT_PUSH_PASSWORD}@${gitRepoPath}
                                        git push origin ${env.GIT_BRANCH}
                                    else
                                        echo "No changes to commit."
                                    fi
                                """
                            }
                        }
                    }
                }
            }
        }
    }
  ```

ìœ„ íŒŒì´í”„ë¼ì¸ì€ ì €ì˜ ìƒí™©ì— ë§ê²Œ êµ¬ì„±ë˜ì–´ ìˆëŠ” íŒŒì´í”„ë¼ì¸ì´ê¸° ë•Œë¬¸ì— ì ì ˆí•˜ê²Œ ë°”ê¾¸ì–´ì„œ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤!<br>

`dir('api-gateway')` ëŠ” ê¹ƒ ë ˆí¬ì§€í† ë¦¬ ë‚´ë¶€ì— ë“¤ì–´ìˆëŠ” í´ë”ë¡œ ë“¤ì–´ê°€ì„œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë¼ëŠ” ì˜ë¯¸ë¡œ ë„£ì–´ ë‘” ì½”ë“œì…ë‹ˆë‹¤.<br>

Jenkinsì˜ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì€ 2ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.<br>

1. 'Pipeline script from SCM' ì˜µì…˜ìœ¼ë¡œ ë¡œì»¬ì—ì„œ ê¹ƒì— í‘¸ì‹œë¥¼ í•  ë•Œ Jenkins íŒŒì´í”„ë¼ì¸ì´ ì‹¤í–‰ë˜ë„ë¡ gitì— íŒŒì´í”„ë¼ì¸ì„ ì—…ë¡œë“œí•œë‹¤.
2. 'Pipeline script' ì˜µì…˜ìœ¼ë¡œ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§ì ‘ ë“±ë¡í•˜ì—¬ Jenkinsì—ì„œ ë¹Œë“œ ë²„íŠ¼ì„ ëˆ„ë¥¸ë‹¤.(ì œê°€ ì‚¬ìš©í•œ ë°©ì‹ì…ë‹ˆë‹¤.)

ì €ëŠ” 2ë²ˆì§¸ ë°©ë²•ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.<br>
MSA ì•„í‚¤í…ì²˜ êµ¬ì¡°ë¡œ êµ¬ì„±ì„ í–ˆëŠ”ë° ë‹¤ìŒì— ë‚˜ì˜¬ ArgoCD íŠ¸ë¦¬ê±° ë°©ì‹ì´ ê¹ƒ ë³€ë™ì‚¬í•­ì„ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ë¼ ê¹ƒì— í‘¸ì‹œë¥¼ ê°ì§€í–ˆì„ ë•Œ ì´ ë¹Œë“œë“¤ì´ í•œêº¼ë²ˆì— ì‹¤í–‰ë˜ë©´ ê¹ƒ ë³€ê²½ ì‚¬í•­ì„ pull í•˜ì§€ ì•Šì•„ì„œ pushê°€ ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ë”ë¼ê³ ìš”,,clone ì´í›„ push ì´ì „ì— pull í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ë„ ìˆì—ˆìŠµë‹ˆë‹¤ë§Œ<br>

> **_í‘¸ì‹œ í•œ ë²ˆì— ëª¨ë“  ì„œë²„ë¥¼ ì¬ë¹Œë“œ, ì¬ë°°í¬ í•˜ê³  ì‹¶ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!_**<br>

ìœ„ì—ì„œ ì–¸ê¸‰í–ˆë˜ ê²ƒì²˜ëŸ¼ ArgoCDëŠ” ê¹ƒì˜ ìƒíƒœê°€ ë³€í•œ ê²ƒì„ ê°ì§€í•˜ê³  deploy.yaml íŒŒì¼ì„ ì‹¤í–‰í•˜ê²Œ ë˜ëŠ”ë°,<br>
Jenkinsì—ì„œ ì§„í–‰ë˜ëŠ” CI ê³¼ì •ì„ ArgoCDê°€ ê°ì§€í•˜ë„ë¡ ë§Œë“¤ê¸° ìœ„í•´ì„œ<br>

1. Jenkinsê°€ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•  ë•Œë§ˆë‹¤ ì´ë¯¸ì§€ì˜ ë²„ì „ ë’¤ì— ëœë¤í•œ ê°’ì„ ë„£ì–´ ê¹ƒì— ì»¤ë°‹, í‘¸ì‹œí•˜ì—¬ ê¹ƒ ë³€ê²½ì„ ê°ì§€í•˜ë„ë¡ í•œë‹¤.(ì œê°€ ì‚¬ìš©í•œ ë°©ì‹ì…ë‹ˆë‹¤.)
2. Webhookì„ ì‚¬ìš©í•œë‹¤.

í•˜ì§€ë§Œ ì €ëŠ” Jenkinsê°€ ë¡œì»¬ì— ìˆê¸° ë•Œë¬¸ì— ì›¹í›…ì„ ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ì–´ì„œ 1ë²ˆ ë°©ì‹ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.<br>

ê·¸ë˜ì„œ ë„ì»¤ ì´ë¯¸ì§€ ë²„ì „ ë’¤ì— ëœë¤í•œ í•´ì‹œì½”ë“œë¥¼ ë¶™ì´ëŠ” ë¡œì§ì´ ì¶”ê°€ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>

<hr>

### ArgoCD

- íŒŒì¼ êµ¬ì„±
  - application.yaml(5ê°œ)
  - git-repository.yaml(5ê°œ)

Jenkinsë¥¼ ì‚¬ìš©í•˜ì—¬ CI ë° CDê¹Œì§€ í•  ìˆ˜ ìˆì§€ë§Œ, ë°°í¬ëœ podê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘ ì¤‘ì¸ì§€, git repositoryì— ì—…ë¡œë“œë˜ì–´ ìˆëŠ” ì½”ë“œì™€ syncê°€ ì¼ì¹˜í•˜ëŠ”ì§€ ë“± podì— ëŒ€í•œ ì •ë³´ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì €ëŠ” ArgoCDë„ í•¨ê»˜ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

ì²˜ìŒ íŒŒì¼ì„ êµ¬ì„±í•  ë•Œ ê¹ƒ Secretì„ í•œ ê°œë§Œ ë“±ë¡í•´ë„, applicationì˜ ì´ë¦„ì„ ë“±ë¡í•˜ì§€ ì•Šì•„ë„ ì „í˜€ ë¬¸ì œê°€ ì—†ë‹¤ëŠ” GPTì˜ ë§ì„ ë¯¿ì–´ë²„ë ¤ì„œ ê³„ì†í•´ì„œ OutOfSync ë¬¸ì œê°€ ë°œìƒí–ˆì—ˆìŠµë‹ˆë‹¤,,<br>

_**ì´ ê¸€ì„ ë³´ëŠ” ë¶„ë“¤ì€ ê¼­ applicationê³¼ git repo ì •ë³´ê°€ ë‹´ê¸´ Secretì„ ì¼ëŒ€ì¼ë¡œ ë§¤í•‘í•˜ì„¸ìš”,,,**_<br>

_**ì ˆëŒ€ application.yaml íŒŒì¼ì„ deploy.yamlì´ ìˆëŠ” í´ë”ì— í•¨ê»˜ ë‘ì§€ ë§ˆì„¸ìš”......**_<br>

> ì €ë„ ì•Œê³  ì‹¶ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤ë§Œ, applicationì´ ë¶ˆëŸ¬ì˜¬ ê¹ƒì˜ ì •ë³´ë¥¼ í•˜ë‚˜í•˜ë‚˜ ë§¤í•‘ì‹œì¼œì¤˜ì•¼ ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>ê·¸ë¦¬ê³  deploy.yaml íŒŒì¼ì´ ìˆëŠ” í´ë”ì— ìˆëŠ” ëª¨ë“  yaml íŒŒì¼ì„ argoCDê°€ ê°ì§€í•´ì„œ ìë™ìœ¼ë¡œ ë°°í¬í•´ì£¼ëŠ” ì‹œìŠ¤í…œì¸ ê²ƒ ê°™ë”ë¼ê³ ìš”...? `App of Apps` ë¼ê³  ëœ¨ë”ë‹ˆ ì „í˜€ êµ¬ë™ì´ ë˜ì§€ ì•ŠëŠ”..(ë­”ê°€ ì¬ê·€ì ì¸ ìƒí™©..?)ìƒí™©ì´......ë²Œì–´ì¡ŒìŠµë‹ˆë‹¤....<br>

_**ê·¸ë¦¬ê³  ê¿€íŒ. ingress.yamlì„ deploy.yamlì´ ìˆëŠ” í´ë”ì— í•¨ê»˜ ë‘ë©´ ArgoCD UIì— ë°”ë¡œê°€ê¸° ë²„íŠ¼ì´ ìƒê¹ë‹ˆë‹¤!**_

<hr>

**[ API Gateway ì„œë²„ì˜ applicaiton.yaml ]**

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: sk067-my-apigateway
  namespace: skala-argocd
spec:
  destination:
    namespace: skala-practice
    server: https://96BD83E8CE5CE0396D006BC5CEB350B0.gr7.ap-northeast-2.eks.amazonaws.com
  project: class-3
  source:
    path: api-gateway/argocd-k8s
    repoURL: https://github.com/Sermadl/devops-source.git
    targetRevision: HEAD
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - PrunePropagationPolicy=background
```

**[ API Gateway ì„œë²„ì˜ git-repository.yaml ]**

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: sk067-repo-1
  namespace: skala-argocd
  labels:
    argocd.argoproj.io/secret-type: repository
type: Opaque
stringData:
  name: sk067-my-apigateway
  type: git
  url: https://github.com/Sermadl/devops-source.git
  username: Sermadl
  project: class-3
  password: { GIT PAT í† í° }
```

_**ê¼­ `stringData.name` í•„ë“œë¥¼ ì´ Secretì´ ì ìš©ë˜ì–´ì•¼ í•˜ëŠ” applicationì˜ ì´ë¦„ìœ¼ë¡œ ì§€ì •í•´ì£¼ì„¸ìš”!**_

<hr>

### ìµœì¢… ê²°ê³¼

![k8s](/assets/img/k8s-result.png)<br>

replicaë¥¼ 2ê°œë¡œ ì„¤ì •í•´ë‘¬ì„œ ì´ë ‡ê²Œ podê°€ 2ê°œì”© ë–´ìŠµë‹ˆë‹¹<br>
ì¶”í›„ì— ë¶„ì‚°ë½ë„ ì ìš©ì„ í•´ë³¼ê¹Œ ìƒê° ì¤‘ì…ë‹ˆë‹¤!<br>

![argocd](/assets/img/argocd-result.png)<br>

ingressê°€ ì ìš©ë˜ì–´ ìˆëŠ” API Gateway ì„œë²„ì™€ Front ì„œë²„ëŠ” ingressë¥¼ ì ìš©í•´ë‘ì–´ì„œ, argocd-k8s í´ë”ì— ë„£ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤!<br>
ê·¸ë˜ì„œ ë°”ë¡œê°€ê¸° ë²„íŠ¼ì´ ë³´ì´ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤<br>

<hr>

## [ ë³´ë„ˆìŠ¤(?) ë‹¨ê³„ ] DB ë° Kafka ë°°í¬..!

### MariaDB

Dockerfileë¡œ ê·¸ëƒ¥ ë„ìš°ë‹¤ê°€ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ë ¤ê³  í•˜ë‹ˆ ë„ˆë¬´ ì–´ë ¤ì› ì§€ë§Œ...kafkaë³´ë‹¤ëŠ” í›¨ì”¬ ì‰¬ì› ìŠµë‹ˆë‹¤.<br>(kafka ê°€ë§Œë‘ì§€ ì•Šê² ì–´)<br>

ì €ëŠ” ê° ë§ˆì´í¬ë¡œ ì„œë¹„ìŠ¤ í•œ ê°œë‹¹ í•œ ê°œì˜ DBë¥¼ ë„ìš¸ ê²ƒì…ë‹ˆë‹¤.<br>

DBë³„ ì´ˆê¸° sql ì„¤ì •ë„ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— 3ê°œì˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  í‘¸ì‹œí•´ì£¼ì—ˆìŠµë‹ˆë‹¤.<br>

ì œ íŒŒì¼ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìƒê²¼ìŠµë‹ˆë‹¤.<br>

![db-file](/assets/img/db-file-structure.png)<br>

ê° í´ë” ì•ˆì—ëŠ” Dockerfileê³¼ init.sql íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤.<br>
`docker-build.sh` íŒŒì¼ í•˜ë‚˜ë¡œ 3ê°œì˜ ì´ë¯¸ì§€ë¥¼ ë™ì‹œì— ìƒì„±í•˜ê³  ì‹¶ì–´ì„œ ì´ë ‡ê²Œ êµ¬ì„±í•´ë‘ì—ˆìŠµë‹ˆë‹¤.<br>

<hr>

**[ itemì˜ Dockerfile ]**

```Dockerfile
FROM mariadb:latest
COPY my.cnf /etc/mysql/conf.d/
COPY item-init.sql /docker-entrypoint-initdb.d/init.sql
RUN chmod 644 /docker-entrypoint-initdb.d/init.sql
```

ì œ Spring ì„œë²„ê°€ R2DBC ê¸°ë°˜ì´ê¸° ë•Œë¬¸ì— ìë™ìœ¼ë¡œ í…Œì´ë¸”ì´ ìƒì„±ë˜ì§€ ì•Šì•„ init.sql íŒŒì¼ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.<br>
í…Œì´ë¸” ìƒì„±í•´ì£¼ëŠ” ê²¸ ì‚¬ìš©ìë„ ë”°ë¡œ ìƒì„±í•´ì£¼ì—ˆìŠµë‹ˆë‹¤!<br>

ê·¸ë¦¬ê³  ê¶Œí•œì„ ê¼­ ë¶€ì—¬í•´ì£¼ì–´ì•¼ init.sqlì˜ ì‹¤í–‰ì´ ë˜ë”ë¼ê³ ìš©,,<br>
ê¼­..ì„¤ì •í•´ì£¼ì„¸ìš©...<br>

ê·¸ë¦¬ê³  ì‚¬ìš©ìë„..í˜¹ì‹œ ëª¨ë¥´ë‹ˆê¹Œ ë”°ë¡œ ë§Œë“¤ì–´ì„œ ì ‘ì†í•˜ì„¸ìš©......<br>
root ì‚¬ìš©ìê°€ localhostì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>

<hr>

**[ docker-build.sh ]**

```sh
#!/bin/bash
VERSION="1.1.0"

sudo docker buildx build \
  --platform linux/amd64 \
  --no-cache \
  -t amdp-registry.skala-ai.com/skala25a/sk067-my-userdb:${VERSION} --push ./user

sudo docker buildx build \
  --platform linux/amd64 \
  --no-cache \
  -t amdp-registry.skala-ai.com/skala25a/sk067-my-orderdb:${VERSION} --push ./order

sudo docker buildx build \
  --platform linux/amd64 \
  --no-cache \
  -t amdp-registry.skala-ai.com/skala25a/sk067-my-itemdb:${VERSION} --push ./item
```

<hr>

**[ statefulSet.yaml ê³¼ ê·¸ ì•ˆì— ìˆëŠ” service ì„¤ì • ]**

```yaml
# Dockerfile ë°©ì‹ìœ¼ë¡œ SQL ì´ˆê¸°í™” ìˆ˜í–‰ (ConfigMap ì œê±°ë¨)
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: sk067-my-db-stateful
  namespace: skala-practice
spec:
  serviceName: sk067-my-db-stateful
  replicas: 1
  selector:
    matchLabels:
      app: sk067-my-db-stateful
  template:
    metadata:
      labels:
        app: sk067-my-db-stateful
    spec:
      containers:
        - name: order-db
          image: amdp-registry.skala-ai.com/skala25a/sk067-my-orderdb:1.1.0
          ports:
            - containerPort: 3306
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: ${ROOT_PASSWORD}
            - name: MYSQL_DATABASE
              value: ${ORDER_DATABASE}
            - name: MYSQL_USER
              value: ${USER}
            - name: MYSQL_PASSWORD
              value: ${PASSWORD}
            - name: MYSQL_TCP_PORT
              value: "3306"

        - name: item-db
          image: amdp-registry.skala-ai.com/skala25a/sk067-my-itemdb:1.1.0
          ports:
            - containerPort: 3307
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: ${ROOT_PASSWORD}
            - name: MYSQL_DATABASE
              value: ${ITEM_DATABASE}
            - name: MYSQL_USER
              value: ${USER}
            - name: MYSQL_PASSWORD
              value: ${PASSWORD}
            - name: MYSQL_TCP_PORT
              value: "3307"

        - name: user-db
          image: amdp-registry.skala-ai.com/skala25a/sk067-my-userdb:1.1.0
          ports:
            - containerPort: 3308
          env:
            - name: MYSQL_ROOT_PASSWORD
              value: ${ROOT_PASSWORD}
            - name: MYSQL_DATABASE
              value: ${USER_DATABASE}
            - name: MYSQL_USER
              value: ${USER}
            - name: MYSQL_PASSWORD
              value: ${PASSWORD}
            - name: MYSQL_TCP_PORT
              value: "3308"

---
apiVersion: v1
kind: Service
metadata:
  name: sk067-order-db
  namespace: skala-practice
spec:
  selector:
    app: sk067-my-db-stateful
  ports:
    - port: 3306
      targetPort: 3306
      name: order
---
apiVersion: v1
kind: Service
metadata:
  name: sk067-item-db
  namespace: skala-practice
spec:
  selector:
    app: sk067-my-db-stateful
  ports:
    - port: 3307
      targetPort: 3307
      name: item
---
apiVersion: v1
kind: Service
metadata:
  name: sk067-user-db
  namespace: skala-practice
spec:
  selector:
    app: sk067-my-db-stateful
  ports:
    - port: 3308
      targetPort: 3308
      name: user
```

Stateful Setì€ podê°€ ë‹¤ì‹œ ë„ì›Œì§€ë”ë¼ë„ DBì˜ ë°ì´í„°ê°€ ìœ ì§€ë˜ê²Œ í•´ì¤ë‹ˆë‹¤.<br>

í•œ pod ë‹¹ í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆë¥¼ ë‹´ë„ë¡ ë§Œë“¤ ìˆ˜ë„ ìˆì—ˆì§€ë§Œ, ìì›ì´ ë„ˆë¬´ ë‚­ë¹„ë˜ëŠ” ê²ƒ ê°™ì•„ ì¼ë‹¨ ì´ëŸ° êµ¬ì¡°ë¡œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.<br>

í•˜ë‹¤ë³´ë‹ˆ serviceë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ì£¼ëŠ”ê²Œ ê·€ì°®ì•„ì„œ ê·¸ëƒ¥ í•œ íŒŒì¼ì— ë‹¤ ë„£ì–´ë²„ë ¸ìŠµë‹ˆë‹¤ ã….ã…<br>
ë³€ìˆ˜ê°€ ë§ì´ ë°”ë€” ì¼ì´ ì—†ì–´ì„œ ê´œì°®ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤<br>

### Kafka (Bitnami ì´ë¯¸ì§€ í™œìš©)

Kafka ì—­ì‹œ ê¸°ì¡´ì—ëŠ” Dockerfileì„ ì´ìš©í•´ ì»¨í…Œì´ë„ˆë¡œ ë„ì› ì§€ë§Œ, ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµì„ ìœ„í•´ ì»¨í…Œì´ë„ˆë¥¼ podë¡œ ê°ì‹¸ì„œ ì˜¬ë ¤ì•¼ í–ˆìŠµë‹ˆë‹¤.<br>

ì´ë•Œ, ì»¨í…Œì´ë„ˆë¥¼ pod 1ê°œ ë‹¹ 1ê°œì”© ë„£ì–´ ì´ 6ê°œ(DB 3ê°œ, Kafka 3ê°œ)ì˜ podë¥¼ ë°°í¬í•  ì§€, pod 1ê°œì— í•„ìš”í•œ ëª¨ë“  ì»¨í…Œì´ë„ˆ(DBì™€ Kafka ê° 3ê°œì”©)ë¥¼ ë„£ì–´ ì´ 2ê°œ(DB 1ê°œ, Kafka 1ê°œ)ì˜ podë¥¼ ë°°í¬í•  ì§€ ê³ ë¯¼ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.<br>

ë§Œì•½, ì‹¤ìŠµì´ ì•„ë‹Œ ì‹¤ì œ ë°°í¬ë¥¼ ì§„í–‰í•˜ëŠ” ìƒí™©ì´ì—ˆë‹¤ë©´ ëª¨ë‘ ë‹¤ë¥¸ podì— ë„£ì–´ ë°°í¬í–ˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.<br>

í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆì— ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ëª¨ë“  ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.<br>

í•˜ì§€ë§Œ ì‹¤ìŠµì„ ì§„í–‰í•˜ê³  ìˆì—ˆê³ , DBë‚˜ Kafkaë¥¼ ë°°í¬í•˜ëŠ” ê²ƒì´ ìš°ì„ ì‹œ ë˜ëŠ” ìƒí™©ì´ ì•„ë‹ˆì—ˆê¸° ë•Œë¬¸ì— ì €ëŠ” ì´ 2ê°œì˜ podë¥¼ ì‚¬ìš©í•´ ë°°í¬ë¥¼ ì§„í–‰í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.<br>

í•˜ì§€ë§Œ........kafka êµ¬ì„±ì„....í•˜ëŠ” ê²ƒì´.........í—·ê°ˆë ¸ã……ë¸Œë‹.ã…....<br>

<hr>

**[ deploy.yaml ]**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sk067-my-kafka
  namespace: skala-practice
spec:
  replicas: 1
  selector:
    matchLabels:
      app: sk067-my-kafka
  template:
    metadata:
      labels:
        app: sk067-my-kafka
    spec:
      containers:
        - name: kafka-broker-0
          image: bitnami/kafka:3.5.1-debian-11-r44
          ports:
            - containerPort: 9092
            - containerPort: 9093
            - containerPort: 9094
          env:
            - name: KAFKA_CFG_BROKER_ID
              value: "0"
            - name: KAFKA_CFG_NODE_ID
              value: "0"
            - name: KAFKA_KRAFT_CLUSTER_ID
              value: HsDBs9l6UUmQq7Y5E6bNlw
            - name: KAFKA_CFG_CONTROLLER_QUORUM_VOTERS
              value: "0@localhost:9093,1@localhost:19093,2@localhost:29093"
            - name: ALLOW_PLAINTEXT_LISTENER
              value: "yes"
            - name: KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE
              value: "true"
            - name: KAFKA_CFG_LISTENERS
              value: "PLAINTEXT://:9092,CONTROLLER://:9093,EXTERNAL://:9094"
            - name: KAFKA_CFG_ADVERTISED_LISTENERS
              value: "PLAINTEXT://localhost:9092,EXTERNAL://sk067-my-kafka:9094"
            - name: KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP
              value: "CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT,PLAINTEXT:PLAINTEXT"
            - name: KAFKA_CFG_OFFSETS_TOPIC_REPLICATION_FACTOR
              value: "1"
            - name: KAFKA_CFG_TRANSACTION_STATE_LOG_REPLICATION_FACTOR
              value: "1"
            - name: KAFKA_CFG_TRANSACTION_STATE_LOG_MIN_ISR
              value: "1"
            - name: KAFKA_CFG_PROCESS_ROLES
              value: "controller,broker"
            - name: KAFKA_CFG_CONTROLLER_LISTENER_NAMES
              value: "CONTROLLER"
        - name: kafka-broker-1
          image: bitnami/kafka:3.5.1-debian-11-r44
          ports:
            - containerPort: 19092
            - containerPort: 19093
            - containerPort: 19094
          env:
            - name: KAFKA_CFG_BROKER_ID
              value: "1"
            - name: KAFKA_CFG_NODE_ID
              value: "1"
            - name: KAFKA_KRAFT_CLUSTER_ID
              value: HsDBs9l6UUmQq7Y5E6bNlw
            - name: KAFKA_CFG_CONTROLLER_QUORUM_VOTERS
              value: "0@localhost:9093,1@localhost:19093,2@localhost:29093"
            - name: ALLOW_PLAINTEXT_LISTENER
              value: "yes"
            - name: KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE
              value: "true"
            - name: KAFKA_CFG_LISTENERS
              value: "PLAINTEXT://:19092,CONTROLLER://:19093,EXTERNAL://:19094"
            - name: KAFKA_CFG_ADVERTISED_LISTENERS
              value: "PLAINTEXT://localhost:19092,EXTERNAL://sk067-my-kafka:19094"
            - name: KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP
              value: "CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT,PLAINTEXT:PLAINTEXT"
            - name: KAFKA_CFG_OFFSETS_TOPIC_REPLICATION_FACTOR
              value: "1"
            - name: KAFKA_CFG_TRANSACTION_STATE_LOG_REPLICATION_FACTOR
              value: "1"
            - name: KAFKA_CFG_TRANSACTION_STATE_LOG_MIN_ISR
              value: "1"
            - name: KAFKA_CFG_PROCESS_ROLES
              value: "controller,broker"
            - name: KAFKA_CFG_CONTROLLER_LISTENER_NAMES
              value: "CONTROLLER"
        - name: kafka-broker-2
          image: bitnami/kafka:3.5.1-debian-11-r44
          ports:
            - containerPort: 29092
            - containerPort: 29093
            - containerPort: 29094
          env:
            - name: KAFKA_CFG_BROKER_ID
              value: "2"
            - name: KAFKA_CFG_NODE_ID
              value: "2"
            - name: KAFKA_KRAFT_CLUSTER_ID
              value: HsDBs9l6UUmQq7Y5E6bNlw
            - name: KAFKA_CFG_CONTROLLER_QUORUM_VOTERS
              value: "0@localhost:9093,1@localhost:19093,2@localhost:29093"
            - name: ALLOW_PLAINTEXT_LISTENER
              value: "yes"
            - name: KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE
              value: "true"
            - name: KAFKA_CFG_LISTENERS
              value: "PLAINTEXT://:29092,CONTROLLER://:29093,EXTERNAL://:29094"
            - name: KAFKA_CFG_ADVERTISED_LISTENERS
              value: "PLAINTEXT://localhost:29092,EXTERNAL://sk067-my-kafka:29094"
            - name: KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP
              value: "CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT,PLAINTEXT:PLAINTEXT"
            - name: KAFKA_CFG_OFFSETS_TOPIC_REPLICATION_FACTOR
              value: "1"
            - name: KAFKA_CFG_TRANSACTION_STATE_LOG_REPLICATION_FACTOR
              value: "1"
            - name: KAFKA_CFG_TRANSACTION_STATE_LOG_MIN_ISR
              value: "1"
            - name: KAFKA_CFG_PROCESS_ROLES
              value: "controller,broker"
            - name: KAFKA_CFG_CONTROLLER_LISTENER_NAMES
              value: "CONTROLLER"
---
apiVersion: v1
kind: Service
metadata:
  name: sk067-my-kafka
  namespace: skala-practice
spec:
  selector:
    app: sk067-my-kafka
  ports:
    - name: kafka-0
      port: 9094
      targetPort: 9094
    - name: kafka-1
      port: 19094
      targetPort: 19094
    - name: kafka-2
      port: 29094
      targetPort: 29094
```

ì—„ì²­ë‚˜ì£ ? ^.^<br>

ê¸°ì¡´ì—ëŠ” ì»¨í…Œì´ë„ˆ 3ê°œë¥¼ í™œìš©í•´ì„œ ë„ì› ê¸° ë•Œë¬¸ì— í¬íŠ¸ ì¶©ëŒì´ ì•ˆ ë‚¬ì—ˆëŠ”ë°,<br>
ì´ë²ˆì—ëŠ” í¬íŠ¸ ì¶©ëŒì´ ì¼ì–´ë‚˜ë‹¤ ë³´ë‹ˆ..ì •ë§ ë„ˆë¬´ë‚˜ë„.....ë””ë²„ê¹…í•˜ê¸° ì–´ë ¤ì› ìŠµë‹ˆë‹¤......<br>

ì‚¬ì‹¤ ì²˜ìŒì— ì•ˆë  ë•ŒëŠ” ë„ëŒ€ì²´ ë­ê°€ ë¬¸ì œì¸ ê²ƒì¸ì§€ ì§ì‘ì´ ì•ˆ ê°”ì—ˆëŠ”ë°<br>
podë¥¼ ì˜¬ë ¤ë†“ê³  ì´ì œ ì„œë²„ì™€ ì—°ê²°í•˜ë ¤ê³  portë¥¼ ì—°ê²°í•  ë•Œ<br>
ê·¸ì œì„œì•¼ í¬íŠ¸ê°€ ì¶©ëŒë˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.<br>

ã…œã…œ.<br>

ì•„ë¬´íŠ¼ ì˜ í•´ê²°í–ˆë‹¤ëŠ” í•´í”¼ ì—”ë”©,,<br>

### Springì—ì„œ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©í•´ì„œ ì—°ê²°í•˜ê¸°

localhost ëŒ€ì‹  ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì ìš©í•´ì£¼ë©´ ì´ì œ ì§„ì§œì§„ì§œ ì ìš© ëì…ë‹ˆë‹¤!<br>

```yaml
spring.application.name=order-service
spring.r2dbc.url=r2dbc:mariadb://sk067-order-db:3306/orders?allowPublicKeyRetrieval=true&useSSL=false
spring.r2dbc.username={ìœ ì €}
spring.r2dbc.password={ë¹„ë°€ë²ˆí˜¸}
server.port=8082
```

ì´ë ‡ê²Œ í•´ì£¼ë©´ ì ìš© ë! ì…ë‹ˆë‹¤ ã…ã…<br>

ì—”ë“œí¬ì¸íŠ¸ëŠ” Serviceì˜ ì´ë¦„ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. í˜¹ì‹œë¼ë„ í—·ê°ˆë¦¬ì‹œë©´ `k get service` ë¡œ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸í•˜ë©´ ë©ë‹ˆë‹¹<br>

<hr>

## ë§ˆì¹˜ë©°

- ê°€ì¥ ì–´ë ¤ì› ë˜ ì 

ì¼ë‹¨ ë””ë²„ê¹…ì´ ì •ë§ ì–´ë µë‹¤..? ëŠ” ì .....? CLIì—ì„œ í•˜ëŠ” ëª¨ë“  ê²ƒì´ ê·¸ë ‡ë“¯ì´<br>
ì—ëŸ¬ ë©”ì‹œì§€ê°€ ëª¨ë“  ê²ƒì„ ì•Œë ¤ì£¼ì§€ ì•Šì•„ì„œ ë””ë²„ê¹…í•˜ê¸°ê°€ ë„ˆë¬´ ì–´ë ¤ì› ìŠµë‹ˆë‹¤...<br>

ê·¸ë˜ë„ ì—´ì‹¬íˆ ì§€í”¼í‹°, í¼í”Œë ‰ì‹œí‹°ì™€ í•¨ê»˜ ë””ë²„ê¹…í–ˆìŠµë‹ˆë‹¤. ì•„ì.<br>

ì œê°€ ê²ªì—ˆë˜ ê±°ì˜ ëª¨ë“  ì˜¤ë¥˜ì— ëŒ€í•œ í•´ê²° ë°©ë²•ì€ ìœ„ì— ì˜ ì°¾ì•„ë³´ì‹œë©´ ìˆìŠµë‹ˆë‹¤,,<br>

- CI/CDë¥¼ êµ¬ì¶•í•˜ë©´ì„œ ëŠë¼ë˜ ìë™í™”ì˜ ì¤‘ìš”ì„±

ì¼ë‹¨ ì „ì— github actionìœ¼ë¡œ CI/CDë¥¼ êµ¬ì¶•í–ˆì„ ë•Œì—ë„ ì •ë§ í¸ë¦¬í•˜ë‹¤ê³  ìƒê°í–ˆì§€ë§Œ<br>
Jenkinsì™€ ArgoCDë¥¼ ì‚¬ìš©í•œ ì§€ê¸ˆë„ ì •ë§ì •ë§ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.<br>

ë¬´ë ¤ ì„œë²„ì˜ êµ¬ë™ ê´€ë¦¬ë¥¼ ìë™í™”í•´ì£¼ëŠ” k8së¥¼ êµ¬ì¶•í•˜ëŠ” deploy ë“± ëª¨ë“  yaml íŒŒì¼ì„ ìë™ìœ¼ë¡œ ê´€ë¦¬í•´ì£¼ëŠ” ArgoCDì˜ Syncë¥¼ ìë™ìœ¼ë¡œ ë§ì¶°ì£¼ëŠ” Jenkinsê¹Œì§€......<br>

ì—­ì‹œ ê°œë°œìë“¤ì€ ìë™í™”ì— ë¯¸ì³(?)ìˆë‹¤ëŠ” ê²ƒì„ ì—¬ì‹¤íˆ ê¹¨ë‹¬ì€ ì‹¤ìŠµì´ì—ˆìŠµë‹ˆë‹¤.<br>

- ë‹¤ìŒ ê³¼ì œ?

2ê°œì˜ podë¥¼ ë„ì› ìœ¼ë‹ˆ, ê±°ê¸°ì„œ ìƒê¸¸ ìˆ˜ ìˆëŠ” DB ì¼ê´€ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë¶„ì‚°ë½ ì ìš©ì— ë„ì „í•´ë³¼ê¹Œ í•©ë‹ˆë‹¤...!<br>

<br>
<hr>

> ì°¸ê³  ìë£Œ

ë†€ëê²Œë„ ëª¨ë“  ê²ƒì€ êµìˆ˜ë‹˜ì˜ ê°•ì˜ìë£Œì— ìˆì—ˆìŠµë‹ˆë‹¤.<br>
ì¢‹ì€ ê°•ì˜ìë£Œ ë§Œë“¤ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!<br>

ğŸ¤“
